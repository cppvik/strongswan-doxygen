<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>strongSwan: scheduler_t Struct Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../strongswan.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">strongSwan
   &#160;<span id="projectnumber">5.3.5</span>
   </div>
   <div id="projectbrief">IPSec implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/d3c/structscheduler__t.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="../../d5/d96/structscheduler__t-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">scheduler_t Struct Reference<div class="ingroups"><a class="el" href="../../d6/dcb/group__scheduler.html">scheduler</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &quot;<a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>&quot;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:aa9d33237a13d5873959ae7f3b4e33c65"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#aa9d33237a13d5873959ae7f3b4e33c65">schedule_job</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, u_int32_t <a class="el" href="../../d9/dbe/test__utils_8c.html#ab51cd24d34f6509eafb5e059f4c7d10e">s</a>)</td></tr>
<tr class="separator:aa9d33237a13d5873959ae7f3b4e33c65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac98edbbabf818fb9a38040ca99eac8a9"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#ac98edbbabf818fb9a38040ca99eac8a9">schedule_job_ms</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, u_int32_t ms)</td></tr>
<tr class="separator:ac98edbbabf818fb9a38040ca99eac8a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad754f9b8ea9dc8ab4c8ee0ef4bf000d2"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#ad754f9b8ea9dc8ab4c8ee0ef4bf000d2">schedule_job_tv</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, <a class="el" href="../../d9/df9/group__time__i.html#gaeba0d8f51eb0a83c2b01ecf27e0b3260">timeval_t</a> tv)</td></tr>
<tr class="separator:ad754f9b8ea9dc8ab4c8ee0ef4bf000d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9121b82b79e8f8ef7f5f3de0b07982c1"><td class="memItemLeft" align="right" valign="top">u_int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#a9121b82b79e8f8ef7f5f3de0b07982c1">get_job_load</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td></tr>
<tr class="separator:a9121b82b79e8f8ef7f5f3de0b07982c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f902c6e40a83c3532cec35c412bf400"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#a6f902c6e40a83c3532cec35c412bf400">flush</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td></tr>
<tr class="separator:a6f902c6e40a83c3532cec35c412bf400"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29c2183272ce274293ad5223741f6f7e"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d3c/structscheduler__t.html#a29c2183272ce274293ad5223741f6f7e">destroy</a> )(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td></tr>
<tr class="separator:a29c2183272ce274293ad5223741f6f7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The scheduler queues timed events which are then passed to the processor.</p>
<p>The scheduler is implemented as a heap. A heap is a special kind of tree- based data structure that satisfies the following property: if B is a child node of A, then key(A) &gt;= (or &lt;=) key(B). So either the element with the greatest (max-heap) or the smallest (min-heap) key is the root of the heap. We use a min-heap with the key being the absolute unix time at which an event is scheduled. So the root is always the event that will fire next.</p>
<p>An earlier implementation of the scheduler used a sorted linked list to store the events. That had the advantage that removing the next event was extremely fast, also, adding an event scheduled before or after all other events was equally fast (all in O(1)). The problem was, though, that adding an event in-between got slower, as the number of events grew larger (O(n)). For each connection there could be several events: IKE-rekey, NAT-keepalive, retransmissions, expire (half-open), and others. So a gateway that probably has to handle thousands of concurrent connnections has to be able to queue a large number of events as fast as possible. Locking makes this even worse, to provide thread-safety, no events can be processed, while an event is queued, so making the insertion fast is even more important.</p>
<p>That's the advantage of the heap. Adding an element to the heap can be achieved in O(log n) - on the other hand, removing the root node also requires O(log n) operations. Consider 10000 queued events. Inserting a new event in the list implementation required up to 10000 comparisons. In the heap implementation, the worst case is about 13.3 comparisons. That's a drastic improvement.</p>
<p>The implementation itself uses a binary tree mapped to a one-based array to store the elements. This reduces storage overhead and simplifies navigation: the children of the node at position n are at position 2n and 2n+1 (likewise the parent node of the node at position n is at position [n/2]). Thus, navigating up and down the tree is reduced to simple index computations.</p>
<p>Adding an element to the heap works as follows: The heap is always filled from left to right, until a row is full, then the next row is filled. Mapped to an array this gets as simple as putting the new element to the first free position. In a one-based array that position equals the number of elements currently stored in the heap. Then the heap property has to be restored, i.e. the new element has to be "bubbled up" the tree until the parent node's key is smaller or the element got the new root of the tree.</p>
<p>Removing the next event from the heap works similarly. The event itself is the root node and stored at position 1 of the array. After removing it, the root has to be replaced and the heap property has to be restored. This is done by moving the bottom element (last row, rightmost element) to the root and then "seep it down" by swapping it with child nodes until none of the children has a smaller key or it is again a leaf node. </p>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00081">81</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>
</div><h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a29c2183272ce274293ad5223741f6f7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* scheduler_t::destroy)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroys a scheduler object. </p>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00125">125</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6f902c6e40a83c3532cec35c412bf400"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* scheduler_t::flush)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all scheduled jobs. </p>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00120">120</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d21/daemon_8c_source.html#l00452">destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="a9121b82b79e8f8ef7f5f3de0b07982c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u_int(* scheduler_t::get_job_load)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns number of jobs scheduled.</p>
<dl class="section return"><dt>Returns</dt><dd>number of scheduled jobs </dd></dl>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00115">115</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d64/vici__query_8c_source.html#l00930">CALLBACK()</a>, and <a class="el" href="../../dd/df3/stroke__list_8c_source.html#l00461">METHOD()</a>.</p>

</div>
</div>
<a class="anchor" id="aa9d33237a13d5873959ae7f3b4e33c65"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* scheduler_t::schedule_job)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, u_int32_t <a class="el" href="../../d9/dbe/test__utils_8c.html#ab51cd24d34f6509eafb5e059f4c7d10e">s</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a event to the queue, using a relative time offset in s.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">job</td><td>job to schedule </td></tr>
    <tr><td class="paramname">time</td><td>relative time to schedule job, in s </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00089">89</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d68/certexpire__cron_8c_source.html#l00060">check_cron()</a>, <a class="el" href="../../d0/d9f/systime__fix__plugin_8c_source.html#l00123">check_systime()</a>, <a class="el" href="../../d0/df4/ike__sa__manager_8c_source.html#l01854">enforce_replace()</a>, <a class="el" href="../../d0/d76/ha__cache_8c_source.html#l00376">ha_cache_create()</a>, <a class="el" href="../../d1/d9c/actions_8c_source.html#l00264">load_action()</a>, <a class="el" href="../../d0/d49/adopt__children__job_8c_source.html#l00057">METHOD()</a>, <a class="el" href="../../d0/d9f/systime__fix__plugin_8c_source.html#l00216">plugin_cb()</a>, <a class="el" href="../../d0/d1e/processor_8c_source.html#l00223">process_job()</a>, <a class="el" href="../../d0/d31/child__rekey_8c_source.html#l00092">schedule_delayed_rekey()</a>, <a class="el" href="../../de/d14/ipsec__sa__mgr_8c_source.html#l00325">schedule_expiration()</a>, <a class="el" href="../../d0/d8e/kernel__wfp__ipsec_8c_source.html#l02082">schedule_expire()</a>, <a class="el" href="../../dc/d9a/child__create_8c_source.html#l00308">schedule_inactivity_timeout()</a>, <a class="el" href="../../d4/d06/aggressive__mode_8c_source.html#l00202">schedule_timeout()</a>, <a class="el" href="../../da/dfd/ha__segments_8c_source.html#l00421">start_autobalance()</a>, and <a class="el" href="../../df/d60/tnc__ifmap__listener_8c_source.html#l00145">tnc_ifmap_listener_create()</a>.</p>

</div>
</div>
<a class="anchor" id="ac98edbbabf818fb9a38040ca99eac8a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* scheduler_t::schedule_job_ms)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, u_int32_t ms)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a event to the queue, using a relative time offset in ms.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">job</td><td>job to schedule </td></tr>
    <tr><td class="paramname">time</td><td>relative time to schedule job, in ms </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00097">97</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

<p>Referenced by <a class="el" href="../../da/da7/led__listener_8c_source.html#l00146">blink_activity()</a>, <a class="el" href="../../d7/d3d/kernel__iph__net_8c_source.html#l00140">fire_roam_event()</a>, <a class="el" href="../../dc/d9a/child__create_8c_source.html#l01099">handle_child_sa_failure()</a>, <a class="el" href="../../dd/d65/task__manager__v1_8c_source.html#l01784">METHOD()</a>, <a class="el" href="../../d0/d1e/processor_8c_source.html#l00223">process_job()</a>, <a class="el" href="../../d9/d32/connect__manager_8c_source.html#l01013">queue_retransmission()</a>, <a class="el" href="../../d5/d90/kernel__netlink__net_8c_source.html#l00602">queue_route_reinstall()</a>, <a class="el" href="../../d0/d09/receiver_8c_source.html#l00417">receive_packets()</a>, <a class="el" href="../../dd/d65/task__manager__v1_8c_source.html#l00344">retransmit_packet()</a>, <a class="el" href="../../d9/d32/connect__manager_8c_source.html#l01167">schedule_checks()</a>, and <a class="el" href="../../d9/d32/connect__manager_8c_source.html#l00886">update_checklist_state()</a>.</p>

</div>
</div>
<a class="anchor" id="ad754f9b8ea9dc8ab4c8ee0ef4bf000d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* scheduler_t::schedule_job_tv)(<a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a> *this, <a class="el" href="../../d2/d68/structjob__t.html">job_t</a> *job, <a class="el" href="../../d9/df9/group__time__i.html#gaeba0d8f51eb0a83c2b01ecf27e0b3260">timeval_t</a> tv)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a event to the queue, using an absolut time.</p>
<p>The passed timeval should be calculated based on the <a class="el" href="../../d9/df9/group__time__i.html#gafa0e4f2038e67e1bb455fb3730f59a1e">time_monotonic()</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">job</td><td>job to schedule </td></tr>
    <tr><td class="paramname">time</td><td>absolut time to schedule job </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/dd8/scheduler_8h_source.html#l00108">108</a> of file <a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d1e/processor_8c_source.html#l00223">process_job()</a>, and <a class="el" href="../../d1/dd0/eap__radius__accounting_8c_source.html#l00639">schedule_interim()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="../../d2/dd8/scheduler_8h_source.html">scheduler.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d2/d3c/structscheduler__t.html">scheduler_t</a></li>
    <li class="footer">Generated on Wed Jan 20 2016 14:04:30 for strongSwan by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
